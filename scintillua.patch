diff -r 2f2ce452fac6 src/SciTEGlobal.properties
--- scite/src/SciTEGlobal.properties	Thu Sep 02 11:27:18 2010 +1000
+++ scite/src/SciTEGlobal.properties	Wed Sep 08 18:33:48 2010 -0400
@@ -505,6 +505,7 @@
 #Lot|lot||\
 #Lout|lt||\
 Lu&a|lua||\
+LPeg|lpeg||\
 Matlab|m.matlab||\
 &Makefile|mak|Ctrl+Shift+F11|\
 #MetaPost|mp||\
diff -r 2f2ce452fac6 src/SciTEProps.cxx
--- scite/src/SciTEProps.cxx	Thu Sep 02 11:27:18 2010 +1000
+++ scite/src/SciTEProps.cxx	Wed Sep 08 18:33:48 2010 -0400
@@ -524,10 +524,17 @@
 	return ret;
 }

+static int lexLPeg = -1;
+
 /**
  * A list of all the properties that should be forwarded to Scintilla lexers.
  */
 static const char *propertiesToForward[] = {
+	"SciteDefaultHome",
+	"fold.by.indentation",
+	"lexer.lua.color.theme",
+	"lexer.lua.home",
+	"lexer.lua.script",
 //++Autogenerated -- run src/LexGen.py to regenerate
 //**\(\t"\*",\n\)
 	"asp.default.language",
@@ -702,7 +709,16 @@
 		if (language.startswith("script_")) {
 			wEditor.Call(SCI_SETLEXER, SCLEX_CONTAINER);
 		} else {
-			wEditor.CallString(SCI_SETLEXERLANGUAGE, 0, language.c_str());
+			if (lexLanguage != lexLPeg) {
+				wEditor.CallString(SCI_SETLEXERLANGUAGE, 0, language.c_str());
+				int lex = wEditor.Call(SCI_GETLEXER);
+				if (lex != SCLEX_NULL && strcmp(language.c_str(), "llpeg") == 0) {
+					lexLPeg = lex;
+					wEditor.CallString(SCI_PRIVATELEXERCALL, SCI_SETLEXERLANGUAGE, "container");
+				}
+			} else {
+				wEditor.CallString(SCI_PRIVATELEXERCALL, SCI_SETLEXERLANGUAGE, language.c_str());
+			}
 		}
 	} else {
 		wEditor.Call(SCI_SETLEXER, SCLEX_NULL);
@@ -1212,6 +1228,18 @@
 void SciTEBase::ReadFontProperties() {
 	char key[200];
 	SString sval;
+	const char *language_name = language.c_str();
+
+	if (lexLanguage == lexLPeg) {
+		// Retrieve style info.
+		char prop_str[256];
+		for (int i = 0; i < STYLE_MAX; i++) {
+			sprintf(key, "style.llpeg.%0d", i);
+			wEditor.Send(SCI_PRIVATELEXERCALL, i - STYLE_MAX, reinterpret_cast<sptr_t>(prop_str));
+			props.Set(key, static_cast<const char*>(prop_str));
+		}
+		language_name = "llpeg";
+	}

 	// Set styles
 	// For each window set the global default style, then the language default style, then the other global styles, then the other language styles
@@ -1224,14 +1252,14 @@
 	SetOneStyle(wEditor, STYLE_DEFAULT, sval.c_str());
 	SetOneStyle(wOutput, STYLE_DEFAULT, sval.c_str());

-	sprintf(key, "style.%s.%0d", language.c_str(), STYLE_DEFAULT);
+	sprintf(key, "style.%s.%0d", language_name, STYLE_DEFAULT);
 	sval = props.GetNewExpand(key);
 	SetOneStyle(wEditor, STYLE_DEFAULT, sval.c_str());

 	wEditor.Call(SCI_STYLECLEARALL, 0, 0);

 	SetStyleFor(wEditor, "*");
-	SetStyleFor(wEditor, language.c_str());
+	SetStyleFor(wEditor, language_name);

 	wOutput.Call(SCI_STYLECLEARALL, 0, 0);

